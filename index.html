<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tikker – Preis-/Mengen‑Rechner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark">
  <style>
    :root { --maxw: 430px; }
    body { background: #fafafa; }
    @media (prefers-color-scheme: dark){ body{ background:#0a0a0a; } }
    .card{ border-radius: 1.25rem; border:1px solid rgb(228,228,231); background:white; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
    @media (prefers-color-scheme: dark){ .card{ background:#111; border-color:#27272a; } }
    .field{ border-radius: 1rem; border:1px solid rgb(212,212,216); background:white; }
    @media (prefers-color-scheme: dark){ .field{ background:#0b0b0b; border-color:#27272a; color:#e5e7eb; } }
    .muted{ color: #71717a; }
    @media (prefers-color-scheme: dark){ .muted{ color:#a1a1aa; } }
    .chip-on{ background:#0a0a0a; color:#fff; }
    @media (prefers-color-scheme: dark){ .chip-on{ background:#e5e7eb; color:#0a0a0a; } }
    .hiddenView{ display:none; }
    .tile{ aspect-ratio: 1/1; }

    #app-root{ opacity:0; transform: translateX(24px); transition: transform .45s cubic-bezier(.22,.61,.36,1), opacity .45s ease; }
    #app-root.enter{ opacity:1; transform: translateX(0); }

    #app-loader{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(255,255,255,.92); z-index:50; transition:opacity .35s ease; }
    @media (prefers-color-scheme: dark){ #app-loader{ background:rgba(10,10,10,.92); } }
    .hub{ position:relative; width:140px; height:140px; transform: rotate(0deg); transition: transform .13s cubic-bezier(.22,.61,.36,1); }
    .blade{ position:absolute; left:50%; top:50%; width:88px; height:18px; transform-origin: 10px 50%; border-radius: 999px; background: linear-gradient(180deg, #111 0%, #000 100%); box-shadow: 0 6px 12px rgba(0,0,0,.2), inset 0 2px 4px rgba(255,255,255,.06); }
    @media (prefers-color-scheme: dark){ .blade{ background: linear-gradient(180deg, #e5e7eb 0%, #cbd5e1 100%); box-shadow: 0 6px 14px rgba(0,0,0,.45), inset 0 2px 4px rgba(0,0,0,.15); } }
    .b0{ transform: translate(-50%,-50%) rotate(0deg); }
    .b1{ transform: translate(-50%,-50%) rotate(90deg); }
    .b2{ transform: translate(-50%,-50%) rotate(180deg); }
    .b3{ transform: translate(-50%,-50%) rotate(270deg); }
    .blade.fly{ transition: transform .18s cubic-bezier(.22,.61,.36,1), opacity .18s ease; opacity:0; }

    .appbar{ backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); background: linear-gradient(180deg, rgba(255,255,255,.68), rgba(255,255,255,.48)); border: 1px solid rgba(228,228,231,.6); box-shadow: 0 8px 24px rgba(0,0,0,.06); }
    @media (prefers-color-scheme: dark){ .appbar{ background: linear-gradient(180deg, rgba(24,24,27,.55), rgba(24,24,27,.35)); border-color: rgba(63,63,70,.6); box-shadow: 0 8px 24px rgba(0,0,0,.35);} }

    .logo{ font-weight: 900; letter-spacing: .04em; line-height: 1; text-shadow: 0 10px 26px rgba(0,0,0,.3); }
    @media (prefers-color-scheme: dark){ .logo{ text-shadow: 0 10px 26px rgba(0,0,0,.45); } }
  </style>

  <!-- PWA essentials -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0a0a0a" />
  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon-180.png">

</head>
<body class="min-h-screen">
  <div id="app-loader">
    <div id="hub" class="hub">
      <div class="blade b0" data-dir="right"></div>
      <div class="blade b1" data-dir="down"></div>
      <div class="blade b2" data-dir="left"></div>
      <div class="blade b3" data-dir="up"></div>
    </div>
  </div>

  <main id="app-root" class="mx-auto min-h-screen max-w-[var(--maxw)] p-3 relative">
    <div class="absolute top-2 left-1/2 -translate-x-1/2 text-2xl font-extrabold tracking-wide text-black/70 dark:text-white/70 drop-shadow-lg select-none">Tikker</div>
    <header class="sticky top-0 z-10 mb-3 rounded-3xl appbar p-3">
      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <button id="backBtn" aria-label="Zurück" class="hidden h-9 w-9 shrink-0 grid place-items-center rounded-2xl border border-zinc-300/60 text-zinc-700 dark:border-zinc-700/60 dark:text-zinc-200">←</button>
          <div class="flex flex-col">
            <div class="logo text-2xl tracking-wide text-zinc-900 dark:text-zinc-100">Tikker</div>
            <div id="subtitle" class="mt-0.5 text-[11px] uppercase tracking-widest text-zinc-500 dark:text-zinc-400">Preis‑/Mengen‑Rechner</div>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-xs muted">Einheit</span>
          <div class="rounded-2xl border border-zinc-300/60 p-1 dark:border-zinc-700/60 bg-white/40 dark:bg-zinc-900/30">
            <div id="unitSwitch" class="flex overflow-hidden rounded-xl text-sm">
              <button data-unit="stk" class="px-3 py-1">Stk</button>
              <button data-unit="g" class="px-3 py-1">g</button>
              <button data-unit="kg" class="px-3 py-1">kg</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div id="views">
      <section id="view-home" class="">
        <div class="grid grid-cols-2 gap-3">
          <button class="tile card p-3 text-left" onclick="setView('a')">
            <div class="text-xl">A</div>
            <div class="mt-1 text-sm font-semibold">Mein Anteil‑Rechner</div>
            <div class="text-xs muted">Budget + Preis → Menge</div>
          </button>
          <button class="tile card p-3 text-left" onclick="setView('b')">
            <div class="text-xl">B</div>
            <div class="mt-1 text-sm font-semibold">Mengen‑Rechner</div>
            <div class="text-xs muted">Menge + Preis → Gesamt</div>
          </button>
          <button class="tile card p-3 text-left" onclick="setView('c')">
            <div class="text-xl">C</div>
            <div class="mt-1 text-sm font-semibold">Kurs‑Rechner</div>
            <div class="text-xs muted">Budget + Menge → max €/Einheit</div>
          </button>
          <button class="tile card p-3 text-left" onclick="setView('d')">
            <div class="text-xl">D</div>
            <div class="mt-1 text-sm font-semibold">Packungen & Einheiten</div>
            <div class="text-xs muted">Packpreis + Einheiten → €/Einheit</div>
          </button>
        </div>
        <p class="mt-4 text-center text-xs muted">Dezimal mit Komma (0,5). Dark Mode automatisch.</p>
      </section>

      <section id="view-a" class="hiddenView">
        <section class="card p-4">
          <h2 class="text-base font-semibold">Mein Anteil‑Rechner</h2>
          <p class="mt-1 text-sm muted">Wie viele <span class="unitLabel">Stk</span> bekomme ich für mein Budget bei diesem Preis pro <span class="unitLabel">Stk</span>?</p>
          <div class="mt-3 flex flex-col gap-3">
            <label class="flex w-full flex-col gap-1">
              <span class="text-xs muted">Budget</span>
              <div class="field flex items-center px-3 py-2">
                <input id="aBudget" inputmode="decimal" type="text" class="w-full bg-transparent text-base outline-none" placeholder="z. B. 24" />
                <span class="select-none pl-2 text-sm muted">€</span>
              </div>
            </label>
            <label class="flex w-full flex-col gap-1">
              <span class="text-xs muted">Preis pro <span class="unitLabel">Stk</span></span>
              <div class="field flex items-center px-3 py-2">
                <input id="aPrice" inputmode="decimal" type="text" class="w-full bg-transparent text-base outline-none" placeholder="z. B. 7" />
                <span class="select-none pl-2 text-sm muted">€</span>
              </div>
            </label>
            <div class="rounded-2xl bg-zinc-100 p-3 text-sm dark:bg-zinc-900">
              <ul class="space-y-1">
                <li><span class="muted">Exakt: </span><b><span id="aExact">–</span> <span class="unitLabel">Stk</span></b></li>
                <li><span class="muted">Ganzzahl kaufbar (abrunden): </span><b><span id="aWhole">–</span> <span class="unitLabel">Stk</span></b></li>
                <li><span class="muted">Ausgegeben (ganzzahlig): </span><b id="aSpent">–</b></li>
                <li><span class="muted">Restgeld: </span><b id="aChange">–</b></li>
              </ul>
            </div>
          </div>
        </section>
      </section>

      <section id="view-b" class="hiddenView">
        <section class="card p-4">
          <h2 class="text-base font-semibold">Mengen‑Rechner</h2>
          <p class="mt-1 text-sm muted">Was kostet meine Zielmenge in <span class="unitLabel">Stk</span>?</p>
          <div class="mt-3 flex flex-col gap-3">
            <label class="flex w-full flex-col gap-1">
              <span class="text-xs muted">Menge (<span class="unitLabel">Stk</span>)</span>
              <div class="field flex items-center px-3 py-2">
                <input id="bQty" inputmode="decimal" type="text" class="w-full bg-transparent text-base outline-none" placeholder="z. B. 50" />
              </div>
            </label>
            <label class="flex w-full flex-col gap-1">
              <span class="text-xs muted">Preis pro <span class="unitLabel">Stk</span></span>
              <div class="field flex items-center px-3 py-2">
                <input id="bPrice" inputmode="decimal" type="text" class="w-full bg-transparent text-base outline-none" placeholder="z. B. 4" />
                <span class="select-none pl-2 text-sm muted">€</span>
              </div>
            </label>
            <div class="rounded-2xl bg-zinc-100 p-3 text-sm dark:bg-zinc-900">
              <div class="flex items-center justify-between"><span class="muted">Gesamtpreis</span><b id="bTotal">–</b></div>
            </div>
          </div>
        </section>
      </section>

      <section id="view-c" class="hiddenView">
        <section class="card p-4">
          <h2 class="text-base font-semibold">Kurs‑Rechner</h2>
          <p class="mt-1 text-sm muted">Welchen maximalen Preis pro <span class="unitLabel">Stk</span> darf ich zahlen?</p>
          <div class="mt-3 flex flex-col gap-3">
            <label class="flex w-full flex-col gap-1">
              <span class="text-xs muted">Budget</span>
              <div class="field flex items-center px-3 py-2">
                <input id="cBudget" inputmode="decimal" type="text" class="w-full bg-transparent text-base outline-none" placeholder="z. B. 50" />
                <span class="select-none pl-2 text-sm muted">€</span>
              </div>
            </label>
            <label class="flex w-full flex-col gap-1">
              <span class="text-xs muted">Zielmenge (<span class="unitLabel">Stk</span>)</span>
              <div class="field flex items-center px-3 py-2">
                <input id="cQty" inputmode="decimal" type="text" class="w-full bg-transparent text-base outline-none" placeholder="z. B. 10" />
              </div>
            </label>
            <div class="rounded-2xl bg-zinc-100 p-3 text-sm dark:bg-zinc-900">
              <div class="flex items-center justify-between"><span class="muted">Max. Preis pro <span class="unitLabel">Stk</span></span><b id="cMax">–</b></div>
            </div>
          </div>
        </section>
      </section>

      <section id="view-d" class="hiddenView">
        <section class="card p-4">
          <h2 class="text-base font-semibold">Packungen & Einheiten</h2>
          <p class="mt-1 text-sm muted">Packpreis & Einheiten/Pack → Preis pro <span class="unitLabel">Stk</span>. Mit Budget: wie viele Packs & Einheiten?</p>
          <div class="mt-3 flex flex-col gap-3">
            <label class="flex w-full flex-col gap-1">
              <span class="text-xs muted">Packpreis</span>
              <div class="field flex items-center px-3 py-2">
                <input id="dPackPrice" inputmode="decimal" type="text" class="w-full bg-transparent text-base outline-none" placeholder="z. B. 12,99" />
                <span class="select-none pl-2 text-sm muted">€</span>
              </div>
            </label>
            <label class="flex w-full flex-col gap-1">
              <span class="text-xs muted">Einheiten pro Pack (<span class="unitLabel">Stk</span>)</span>
              <div class="field flex items-center px-3 py-2">
                <input id="dUnitsPerPack" inputmode="decimal" type="text" class="w-full bg-transparent text-base outline-none" placeholder="z. B. 6" />
              </div>
            </label>
            <label class="flex w-full flex-col gap-1">
              <span class="text-xs muted">Budget (optional)</span>
              <div class="field flex items-center px-3 py-2">
                <input id="dBudget" inputmode="decimal" type="text" class="w-full bg-transparent text-base outline-none" placeholder="z. B. 40" />
                <span class="select-none pl-2 text-sm muted">€</span>
              </div>
            </label>
            <div class="rounded-2xl bg-zinc-100 p-3 text-sm dark:bg-zinc-900">
              <ul class="space-y-1">
                <li><span class="muted">Preis pro <span class="unitLabel">Stk</span>: </span><b id="dPerUnit">–</b></li>
                <li><span class="muted">Packs mit Budget (ganzzahlig): </span><b id="dPacksWhole">–</b></li>
                <li><span class="muted">Einheiten aus Budget: </span><b><span id="dUnits">–</span> <span class="unitLabel">Stk</span></b></li>
                <li><span class="muted">Restgeld: </span><b id="dChange">–</b></li>
              </ul>
            </div>
          </div>
        </section>
      </section>
    </div>
  </main>

  <script>
    const views = {
      home: document.getElementById('view-home'),
      a: document.getElementById('view-a'),
      b: document.getElementById('view-b'),
      c: document.getElementById('view-c'),
      d: document.getElementById('view-d'),
    };
    const backBtn = document.getElementById('backBtn');
    const subtitle = document.getElementById('subtitle');
    const unitSwitch = document.getElementById('unitSwitch');

    const nfEUR = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' });
    const nfNUM = new Intl.NumberFormat('de-DE', { maximumFractionDigits: 3 });
    function parseNum(v){ if(typeof v !== 'string') return NaN; v = v.replace(/\s/g,'').replace(',', '.'); return parseFloat(v); }
    function fmtMoney(n){ return isFinite(n) ? nfEUR.format(n) : '–'; }
    function fmtNum(n){ return isFinite(n) ? nfNUM.format(n) : '–'; }

    let unit = 'Stk';
    function setUnit(u){
      unit = u === 'g' ? 'g' : u === 'kg' ? 'kg' : 'Stk';
      document.querySelectorAll('.unitLabel').forEach(el => el.textContent = unit);
      if(unitSwitch){ unitSwitch.querySelectorAll('button').forEach(btn => { btn.classList.toggle('chip-on', btn.dataset.unit === (unit === 'Stk' ? 'stk' : unit)); }); }
      computeAll();
    }
    if(unitSwitch){ unitSwitch.addEventListener('click', (e)=>{ const btn = e.target.closest('button[data-unit]'); if(!btn) return; setUnit(btn.dataset.unit); }); }

    function setView(id){
      Object.values(views).forEach(v => v.classList.add('hiddenView'));
      if(views[id]){ views[id].classList.remove('hiddenView'); if(subtitle){ subtitle.textContent = {home:'Start',a:'Mein Anteil‑Rechner',b:'Mengen‑Rechner',c:'Kurs‑Rechner',d:'Packungen & Einheiten'}[id] || ''; } }
      if(backBtn){ backBtn.classList.toggle('hidden', id === 'home'); }
      location.hash = '#' + id;
      computeAll();
    }
    if(backBtn){ backBtn.addEventListener('click', ()=> setView('home')); }
    window.addEventListener('hashchange', ()=>{ const id = location.hash.replace('#',''); if(views[id]) setView(id); });

    function computeA(){
      const budget = parseNum((document.getElementById('aBudget')||{}).value || '');
      const price = parseNum((document.getElementById('aPrice')||{}).value || '');
      const exact = budget/price; const whole = Math.floor(exact); const spent = whole * price; const change = budget - spent;
      const aExact = document.getElementById('aExact'); const aWhole = document.getElementById('aWhole'); const aSpent = document.getElementById('aSpent'); const aChange = document.getElementById('aChange');
      if(aExact) aExact.textContent = fmtNum(exact);
      if(aWhole) aWhole.textContent = isFinite(whole) ? nfNUM.format(whole) : '–';
      if(aSpent) aSpent.textContent = fmtMoney(spent);
      if(aChange) aChange.textContent = fmtMoney(change);
    }
    function computeB(){ const qty = parseNum((document.getElementById('bQty')||{}).value || ''); const price = parseNum((document.getElementById('bPrice')||{}).value || ''); const total = qty * price; const bTotal = document.getElementById('bTotal'); if(bTotal) bTotal.textContent = fmtMoney(total); }
    function computeC(){ const budget = parseNum((document.getElementById('cBudget')||{}).value || ''); const qty = parseNum((document.getElementById('cQty')||{}).value || ''); const max = budget / qty; const cMax = document.getElementById('cMax'); if(cMax) cMax.textContent = isFinite(max) ? nfEUR.format(max) : '–'; }
    function computeD(){
      const packPrice = parseNum((document.getElementById('dPackPrice')||{}).value || '');
      const unitsPerPack = parseNum((document.getElementById('dUnitsPerPack')||{}).value || '');
      const budget = parseNum((document.getElementById('dBudget')||{}).value || '');
      const perUnit = packPrice / unitsPerPack;
      const dPerUnit = document.getElementById('dPerUnit'); const dPacksWhole = document.getElementById('dPacksWhole'); const dUnits = document.getElementById('dUnits'); const dChange = document.getElementById('dChange');
      if(dPerUnit) dPerUnit.textContent = isFinite(perUnit) ? nfEUR.format(perUnit) : '–';
      const packsWhole = Math.floor(budget / packPrice); if(dPacksWhole) dPacksWhole.textContent = isFinite(packsWhole) ? nfNUM.format(packsWhole) : '–';
      const unitsCalc = Math.floor(budget / perUnit); if(dUnits) dUnits.textContent = isFinite(unitsCalc) ? nfNUM.format(unitsCalc) : '–';
      const change = budget - (isFinite(unitsCalc) ? unitsCalc * perUnit : NaN); if(dChange) dChange.textContent = fmtMoney(change);
    }
    function computeAll(){ computeA(); computeB(); computeC(); computeD(); }

    function bindInputs(){ ['aBudget','aPrice','bQty','bPrice','cBudget','cQty','dPackPrice','dUnitsPerPack','dBudget'].forEach(id=>{ const el = document.getElementById(id); if(!el) return; el.addEventListener('input', computeAll); el.addEventListener('change', computeAll); }); }

    async function startLoader(){
      const loader = document.getElementById('app-loader'); const hub = document.getElementById('hub'); if(!loader || !hub) return;
      const blades = Array.from(hub.querySelectorAll('.blade')); const dirs = ['right','down','left','up'];
      let rot = 0;
      for(let i=0;i<4;i++){
        hub.style.transform = `rotate(${rot}deg)`;
        await new Promise(r=>setTimeout(r, 130));
        const dir = dirs[(rot/90)%4]; const blade = blades.find(b=>b.dataset.dir===dir);
        if(blade){
          blade.classList.add('fly');
          if(dir==='right') blade.style.transform = 'translate(calc(50% + 260px), -50%) rotate(0deg)';
          if(dir==='down') blade.style.transform = 'translate(-50%, calc(50% + 260px)) rotate(90deg)';
          if(dir==='left') blade.style.transform = 'translate(calc(-150% - 260px), -50%) rotate(180deg)';
          if(dir==='up') blade.style.transform = 'translate(-50%, calc(-150% - 260px)) rotate(270deg)';
          await new Promise(r=>setTimeout(r, 180));
        }
        rot += 90;
      }
      await new Promise(r=>setTimeout(r, 120));
      const app = document.getElementById('app-root'); if(app){ app.classList.add('enter'); }
      loader.style.opacity = '0'; await new Promise(r=>setTimeout(r, 175)); loader.remove();
    }

    document.addEventListener('DOMContentLoaded', async () => {
      bindInputs(); setUnit('stk');
      const id = location.hash.replace('#',''); if (views[id]) setView(id); else setView('home');
      await startLoader();
    });
  </script>

  <script>
    // Register Service Worker (same-origin only)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(console.warn);
      });
    }
    // Handle iOS safe areas for notch/home indicator
    document.documentElement.style.setProperty('--sat', (window.navigator.standalone ? 'env(safe-area-inset-top)' : '0px'));
  </script>

</body>
</html>