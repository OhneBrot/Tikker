<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tikker</title>
<style>
  :root{ --bg:#111; --fg:#fff; }
  *{ box-sizing:border-box; }
  body{ font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--fg); margin:0; }
  /* Loader */
  #loader{ position:fixed; inset:0; background:rgba(0,0,0,.86); display:grid; place-items:center; z-index:9999; transition:opacity .45s ease; }
  .dial{ position:relative; width:160px; height:160px; }
  .hand{
    position:absolute; left:50%; top:50%;
    width:90px; height:6px; border-radius:3px;
    background:rgba(255,255,255,.92);
    box-shadow:0 8px 18px rgba(0,0,0,.45);
    /* pivot exactly at the center of the dial */
    transform-origin:0 50%;
    transform:translate(0,-50%) rotate(0deg);
  }
  .center-dot{
    position:absolute; left:50%; top:50%; width:10px; height:10px; border-radius:50%;
    background:rgba(255,255,255,.95); transform:translate(-50%,-50%);
    box-shadow:0 6px 14px rgba(0,0,0,.4);
  }
  /* UI */
  .container{ max-width:560px; margin:40px auto; padding:20px; background:rgba(255,255,255,.05); border-radius:12px; backdrop-filter:blur(6px); }
  h1{ margin:0 0 12px; font-size:22px; }
  .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .row-1{ display:grid; grid-template-columns:1fr; gap:10px; }
  input,button{ padding:12px 14px; border-radius:10px; border:none; font-size:16px; }
  input{ width:100%; background:rgba(255,255,255,.1); color:#fff; outline:none; }
  input::placeholder{ color:rgba(255,255,255,.6); }
  button{ cursor:pointer; background:#e5e7eb; }
  .btn-primary{ background:#16a34a; color:#fff; }
  .btn-danger{ background:#dc2626; color:#fff; }
  table{ width:100%; margin-top:15px; border-collapse:collapse; }
  th,td{ padding:10px; border-bottom:1px solid rgba(255,255,255,.1); text-align:left; font-size:15px; }
  .actions{ display:flex; gap:8px; }
  .hint{ color:rgba(255,255,255,.7); font-size:13px; margin-top:6px; }
</style>
</head>
<body>
  <div id="loader" aria-hidden="true">
    <div class="dial">
      <div class="hand" id="hand"></div>
      <div class="center-dot"></div>
    </div>
  </div>

  <div class="container">
    <h1>Für Kunden</h1>
    <div class="row-1"><input id="name" placeholder="Name"></div>
    <div class="row"><input id="datum" placeholder="Datum (TT.MM)"><input id="anzahl" placeholder="Stückzahl" inputmode="decimal"></div>
    <div class="row"><input id="betrag" placeholder="Betrag in €" inputmode="decimal"><input id="note" placeholder="Anmerkungen (optional)"></div>
    <div class="actions">
      <button id="addBtn" class="btn-primary">Hinzufügen</button>
      <button id="clearBtn" class="btn-danger">Leeren</button>
    </div>
    <div class="hint">Einträge bleiben lokal gespeichert (LocalStorage).</div>
    <table aria-label="Gespeicherte Einträge">
      <thead><tr><th>Name</th><th>Datum</th><th>Stückzahl</th><th>Betrag</th><th>Anmerkungen</th><th></th></tr></thead>
      <tbody id="list"></tbody>
    </table>
  </div>

<script>
  const loader = document.getElementById('loader');
  const hand = document.getElementById('hand');
  const listEl = document.getElementById('list');
  const addBtn = document.getElementById('addBtn');
  const clearBtn = document.getElementById('clearBtn');
  const KEY = 'tikkerListe';
  let eintraege = [];
  let loaderRan = false; // double-call guard

  function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

  async function startLoaderTick(){
    if(loaderRan) return;
    loaderRan = true;
    if(!loader || !hand){ return; }
    const steps = 8;      // ticks
    const delay = 120;    // ms
    for(let i=0;i<steps;i++){
      const angle = i * (360/steps);
      hand.style.transform = 'translate(0,-50%) rotate(' + angle + 'deg)';
      await sleep(delay);
    }
    loader.style.opacity = '0';
    loader.style.pointerEvents = 'none';
    await sleep(220);
    loader.remove();
  }

  function save(){ localStorage.setItem(KEY, JSON.stringify(eintraege)); }
  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      eintraege = raw ? JSON.parse(raw) : [];
      if(!Array.isArray(eintraege)) eintraege = [];
    }catch(e){ eintraege = []; }
  }
  function renderListe(){
    listEl.innerHTML = '';
    eintraege.forEach((e,i)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = \`
        <td>\${e.name||''}</td>
        <td>\${e.datum||''}</td>
        <td>\${e.anzahl||''}</td>
        <td>\${e.betrag ? (Number(e.betrag).toLocaleString('de-DE',{style:'currency',currency:'EUR'})) : ''}</td>
        <td>\${e.note||''}</td>
        <td><button data-i="\${i}" class="btn-danger" style="padding:6px 10px">Quitt</button></td>
      \`;
      listEl.appendChild(tr);
    });
    listEl.querySelectorAll('button[data-i]').forEach(btn=>{
      btn.addEventListener('click', (ev)=>{
        const i = Number(ev.currentTarget.dataset.i);
        if(Number.isInteger(i)){ eintraege.splice(i,1); save(); renderListe(); }
      });
    });
    save();
  }

  addBtn.addEventListener('click', ()=>{
    const name   = document.getElementById('name').value.trim();
    const datum  = document.getElementById('datum').value.trim();
    const anzahl = document.getElementById('anzahl').value.trim();
    const betrag = document.getElementById('betrag').value.trim();
    const note   = document.getElementById('note').value.trim();
    if(!name || !datum || !anzahl || !betrag){ alert('Bitte alle Pflichtfelder ausfüllen.'); return; }
    eintraege.push({ name, datum, anzahl, betrag: betrag.replace(',', '.'), note });
    renderListe();
    ['name','datum','anzahl','betrag','note'].forEach(id=>document.getElementById(id).value='');
  });
  clearBtn.addEventListener('click', ()=>{
    if(confirm('Wirklich gesamte Liste löschen?')){ eintraege=[]; renderListe(); }
  });

  load();
  renderListe();
  startLoaderTick();
</script>
</body>
</html>
